# 图片走廊功能说明

## 功能概述

图片走廊是一个展示已生成图片的界面，用户可以浏览图片、查看生成参数，并快速生成相似的图片。

## 主要功能

### 1. 图片展示
- 4列等宽网格布局展示所有已生成的图片
- 每列宽度完全相等（25%），确保视觉平衡
- 每列使用flex布局垂直排列图片
- 图片按照原始尺寸比例显示：
  - 正方形图片（512x512, 1024x1024）：1:1比例
  - 宽屏图片（912x512, 1280x720）：16:9比例
  - 竖屏图片（512x912, 720x1280）：9:16比例
- 图片平均分配到4列中，确保每列高度平衡
- 响应式设计，支持不同屏幕尺寸
- 大屏幕：4列等宽布局
- 中等屏幕：2列等宽布局  
- 小屏幕：1列全宽布局
- 每个图片显示缩略图、生成时间、尺寸和seed信息

### 2. 悬停交互
- 鼠标悬停在图片上时显示半透明遮罩
- 遮罩中显示完整的prompt文本
- 显示图片的详细参数（尺寸、seed、生成时间）

### 3. 生成同款
- 点击"生成同款"按钮跳转到图片生成页面
- 自动填充选中图片的prompt、尺寸、seed和negative prompt
- 用户可以修改参数后重新生成

### 4. 筛选功能
- 全部图片：显示所有图片
- 最近生成：显示24小时内生成的图片
- 热门图片：显示最受欢迎的图片（可扩展）

## 技术实现

### 前端页面
- `static/gallery.html` - 图片走廊主页面
- 使用Flexbox布局实现4列等宽响应式网格
- CSS `width: calc(25% - 15px)` 确保每列等宽
- 动态列数调整（4列/2列/1列），保持等宽特性
- 图片比例自适应：根据原始尺寸设置 `aspect-ratio`
- JavaScript处理图片分配和交互
- 窗口大小改变时自动重新布局

### 后端API
- `GET /v1/gallery` - 获取图片走廊数据
- `GET /gallery` - 重定向到图片走廊页面

### 数据模型
```python
class GalleryImage(BaseModel):
    id: int
    image_url: str
    prompt: str
    negative_prompt: Optional[str] = None
    size: str
    seed: Optional[int] = None
    timestamp: float
    guidance_scale: float = 5.0
    num_inference_steps: int = 20
```

## 使用方法

### 1. 访问图片走廊
- 在图片生成页面点击右上角的"🖼️ 图片走廊"按钮
- 或直接访问 `/gallery` 路径

### 2. 浏览图片
- 滚动浏览所有图片
- 使用筛选按钮查看不同类型的图片
- 鼠标悬停查看详细信息

### 3. 生成同款
- 点击图片上的"生成同款"按钮
- 系统自动跳转到图片生成页面
- 表单已预填充选中图片的参数
- 可以修改参数后点击生成

## 参数传递

从图片走廊跳转到生成页面时，通过URL参数传递以下信息：
- `prompt` - 图片的prompt文本
- `size` - 图片尺寸
- `seed` - 随机种子
- `negative_prompt` - 负面prompt

示例URL：
```
/index.html?prompt=A%20beautiful%20landscape&size=512x512&seed=12345&negative_prompt=blurry
```

## 扩展功能

### 1. 数据库集成
当前使用模拟数据，可以扩展为：
- 将生成的图片信息保存到数据库
- 记录用户生成历史和偏好
- 支持图片收藏和分享

### 2. 图片管理
- 图片删除功能
- 图片分类和标签
- 批量操作

### 3. 社交功能
- 用户评论和点赞
- 图片分享到社交媒体
- 用户关注和推荐

### 4. 高级筛选
- 按prompt关键词搜索
- 按生成时间范围筛选
- 按图片尺寸筛选
- 按生成参数筛选

## 文件结构

```
static/
├── gallery.html          # 图片走廊页面
├── index.html           # 图片生成页面（已更新）
└── styles.css           # 样式文件

main.py                  # 后端API（已更新）
schemas.py               # 数据模型（已更新）
test_gallery.py          # 测试脚本
GALLERY_FEATURE.md       # 功能说明文档
```

## 测试

运行测试脚本验证功能：
```bash
python test_gallery.py
```

## 注意事项

1. 当前使用模拟数据，实际部署时需要集成数据库
2. 图片URL使用base64编码的SVG占位符，实际使用时需要真实的图片URL
3. 时间戳使用Unix时间戳，前端需要转换为相对时间显示
4. 确保API服务器正常运行才能访问图片走廊功能 